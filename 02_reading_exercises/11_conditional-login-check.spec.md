# 11：条件に応じて処理を分岐する（if文）

## テストコード

```js
await page.goto('https://example.com/login');
const loginButton = await page.locator('button#login');

const isLoginRequired = await page.locator('div#login-message').isVisible();

if (isLoginRequired) {
    await loginButton.click();
    await page.locator('input#username').fill('testuser');
    await page.locator('input#password').fill('securepassword');
    await page.locator('button#submit').click();
}

await page.locator('div#profile').waitFor({ state: 'visible' });
```

### 問題

問１

上記のテストコードが行っている操作の流れを、日本語で説明してください。

問２

このテストコードで確認している観点（チェックポイント）は何でしょうか？

条件に応じて処理を分岐している箇所についても解説してください。

### 自分の回答

問１
1. Example.comのログイン画面を開示する
2. ログインボタンが表示されるまで待機する
3. ログインメッセージが表示されるまで待機する
4. 以下条件
    - UserNameに「testuser」が入っている
    - PassWordに「ecurepassword」が入っている
    - Submit(大抵は「ログイン」）が押下されている
5. 条件が満たしていればプロフィール画面に遷移することを確認する

問２

ログイン情報(ユーザーネーム・パスワード)が正しく入力されており、ログインボタンを押下することでログインができることの確認

### 回答/解説

#### 問１

1. Example.comのログイン画面を開く
    - `await page.goto('https://example.com/login');`により、ログイン画面が表示される。
2. ログインボタンが表示されるまで待機
    - `const loginButton = await page.locator('button#login');`は、ログインボタンを取得し、そのボタンが画面に表示されるのを待っている。
3. ログインメッセージが表示されるまで待機
    - `const isLoginRequired = await page.locator('div#login-message').isVisible();`は、ログインが必要な場合に表示されるメッセージが表示されるまで待機します。
４. 条件に応じてログイン処理を行う
    - `if (isLoginRequired)`の部分で、もしログインが必要であれば、次の処理が実行される：
       - ユーザー名（`testuser`）を入力
       - パスワード（`securepassword`）を入力
       - ログインボタン（`submit`）をクリック
5. プロフィール画面への遷移を確認
    - 最後に、ログイン後にプロフィール画面が表示されることを確認する。`await page.locator('div#profile').waitFor({ state: 'visible' });`で、プロフィール画面が表示されるまで待機する。

#### 問２

**確認している観点（チェックポイント）**は以下の通りである：
- **ログインが必要かどうか**：`isVisible()` メソッドを使ってログインメッセージが表示されるかをチェックし、必要に応じてログイン処理を分岐させている。
- **正しい情報が入力されるか**：ユーザー名とパスワードがそれぞれ `testuser` と `securepassword` に設定され、ログインボタンが押下されることを確認している。
- **ログイン後の画面遷移**：ログイン処理が正常に行われた場合に、プロフィール画面が表示されるかを確認している。

このコードのポイントは、「ログインが必要な場合にのみログイン処理を行う」点にあり、条件によって動作を分岐している。

### 追加質問

#### 質問１

「ログインが必要かどうか」というのは、例えばログインボタンと会員登録ボタンが表示されているような画面をイメージすればいいか

#### 質問１の解答・解説

「ログインが必要かどうか」を確認する場合、実際には次のような画面を想定でる：

- ログイン画面：まだログインしていない状態では、画面に「ログインボタン」や「会員登録ボタン」が表示されていることが多いです。このようなボタンが表示されている場合は、ユーザーはまだログインしていない状態である。
- ログイン後の画面：すでにログイン済みの場合、「ログインボタン」や「会員登録ボタン」は表示されないことが多く、その代わりに「ログアウトボタン」や「プロフィール」などが表示される。

#### 質問２

前者は例えば未登録ユーザーとか、ログアウトした登録済みユーザーを想定している認識か

#### 質問２の解答・解説

未登録のユーザーや、ログアウトした状態で再度ログインが必要なユーザーを想定している。これらのユーザーにはログイン画面でのボタンやメッセージが表示され、ログイン処理を行う必要がある場合がある。

この場合、条件分岐を用いて「ログイン画面に遷移する」か、「すでにログインしている場合はプロフィール画面に遷移する」といった流れで確認ができる。

#### 質問３

後者はログインしたけど、例えばタブを閉じたり、一度アプリを終了させたりした状態か

いわゆるログイン状態をキープするにチェックを入れたりしているとか

#### 質問３の解答・解説

後者は、ユーザーがすでにログインした状態でも、ブラウザを閉じたりアプリを終了させたりした後のケースを指す。これには、例えば「ログイン状態をキープする」や「自動ログイン」のオプションを有効にしている場合が該当する。

この場合、再度サイトを開いたときにログイン状態が保持されているかどうかを確認する必要がある。もし保持されていない場合、再度ログイン画面が表示されるか、再ログインを求められるケースもある。

具体的には以下のようなシナリオになる：

- ログイン後にブラウザやアプリを閉じ、再度開くときに「自動ログイン」が有効ならば、ログイン状態が維持され、いきなりプロフィール画面に遷移する。
- もし「自動ログイン」が無効だった場合、再度ログイン画面に遷移してログインが必要となる。

この場合、テストコードの中で「ユーザーが再度ログインを求められないか」を確認することができる。

#### 質問４

つまりログインしている状態でも履歴削除やキャッシュクリアなどで再ログインが必要となると前者になるってことでいいか

#### 質問４の解答・解説

ログインしている状態でも、履歴の削除やキャッシュのクリアを行うと、再度ログインが必要になる場合がある。この場合は、前者に該当する。

具体的には、以下のような状況になる：

- ユーザーが一度ログインしても、ブラウザの履歴やキャッシュをクリアした場合、ログインセッションが失われることがある。
- この場合、次回アクセス時にログイン状態が保持されず、再ログインが必要となる。

このような場合に備えて、テストでは「再度ログインが必要かどうか」を確認することが求められる。
