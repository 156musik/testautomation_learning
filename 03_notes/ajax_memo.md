# Ajaxについて

[08_wait_visible.md](u02_reading_exercises/08_wait_visible.md) の出題をやっている時に**Ajax**が出てきた

自動改限定でないと思うが、Ajaxについて理解ができていないので質問してみた

## Ajaxとは

- 正式名称は**Asynchronous JavaScript and XML（非同期のJavaScriptとXML）**
- **ページ全体を再読み込みせずに、一部だけデータを取りに行く技術**のこと

## 具体的に言うと

昔は、何か操作をしたらページ全体が「ガッ！」と更新されていた。
（クリックすると全部白くなって、再読み込みされる感じ）

でもAjaxを使うことで下記のことができるようになった
- ボタンを押しても、ページはそのまま
- 裏でサーバーにリクエストを飛ばして、
- 帰ってきたデータだけを、必要な部分に差し込む

## 例

- 商品の「もっと見る」ボタンを押したら、下に商品が追加される（ページ全体は更新されない）
- コメント欄に書き込んだら、すぐ反映される（投稿ボタン押してもページがリロードされない）
- 検索ボックスに文字を打ったら、すぐに候補リストが出る

これらはほぼ全部、**Ajaxを使った「部分更新」**である。

## ポイントまとめ

| ポイント   | 内容                          |
| :----- | :-------------------------- |
| Ajaxは  | ページ全体を更新しないで、データ通信する技術      |
| メリット   | ページが速く・なめらかに動く              |
| 出やすい場面 | 「ロード中...」「読み込み中です」みたいな表示が出る |

## なぜテスト自動化で重要か

- Ajaxで「あとから」要素が出るので
- すぐに検証しようとすると「まだ出てない！」というエラーになる
- だから、「要素が現れるのを待つ」という技術が必要になる

## Ajaxが使われている代表的なサイト例

| サイト例            | Ajaxが使われているところ                          |
| :-------------- | :-------------------------------------- |
| **Google検索**    | 入力中に、関連キーワードが自動でサジェストされる                |
| **YouTube**     | 動画一覧の「さらに表示」ボタンで、動画が追加される               |
| **Twitter (X)** | 「もっと見る」で新しいツイートが追加される（リロードなし）           |
| **Amazon**      | 商品一覧で「次のページ」がスムーズに読み込まれるパターンあり          |
| **楽天市場**        | 商品絞り込み（左側のフィルター）を使うとすぐ反映される（全部再読み込みしない） |

## 身近な例

たとえばGoogleで「playwright」と打ち始めたとき、まだエンター押してないのに下に関連候補が出て来る

あれは裏で非同期通信（Ajax）が走って、「今このワードに近いキーワード候補をください！」ってサーバーに問い合わせて、サーバーから帰ってきたデータだけをサジェストリストに差し込んでいるためである。

## 重要なポイント

- **画面全体が真っ白にならない**＝ページリロードなし
- **部分的にだけ情報が更新される**
- **裏で勝手に通信しているから、ユーザーにはバレないくらいスムーズ**

つまり**一見なにごともないように見えるけど、裏では超忙しく動いている**

なので、**画面設計書に載ってない動きがあるとき＝Ajaxの可能性が高い**と思っていい

※設計書で「ここの更新は非同期です」とか書いてあることもあるけど、ないことも多い

## Ajax通信をブラウザで観察する手順

1. Chrome（またはEdgeなど）で、観察したいサイトを開く
2. キーボードで「F12」を押す（または右クリック → 「検証」を選ぶ）
    - 開発者ツールが開く
3.  開発者ツール内で「Network（ネットワーク）」タブをクリックする
    - このタブは通信のやりとりを一覧できる場所である
4. さらに「XHR」というフィルターを選ぶ
    - XHRとは、XMLHttpRequestの略です（＝Ajax通信はほぼここに出る）
    - ここを押すと「Ajax通信だけ」に絞り込める
5. ページ上で何か操作をする（例：Google検索バーに文字を打ち始める）
    - 開発者ツールの「XHR」に通信が流れてくる
        - これが、リアルタイムでAjaxが飛んでいる瞬間である

## まとめイメージ

| 手順           | 内容                |
| :----------- | :---------------- |
| F12キーを押す     | 開発者ツールを出す         |
| Networkタブを選ぶ | 通信の一覧を表示する        |
| XHRフィルターを押す  | Ajax通信だけに絞る       |
| サイト上で操作してみる  | 通信が走る様子をリアルタイムで見る |

## 応用

- どのURLにリクエストしているか見える
- リクエストにどんなパラメータを送っているか見える
- サーバーからどんなデータ（JSONなど）が返ってきているか見える

つまり、**「設計書にない仕様」を自分で確かめる力**がつく

## Ajax通信の練習に向いている無料サイト

| サイト名                  | URL                                                                            | 特徴                              |
| :-------------------- | :----------------------------------------------------------------------------- | :------------------------------ |
| JSONPlaceholder       | [https://jsonplaceholder.typicode.com/](https://jsonplaceholder.typicode.com/) | テスト用のAPIがたくさん使える。ブラウザでXHR確認できる。 |
| Reqres.in             | [https://reqres.in/](https://reqres.in/)                                       | 実際にPOST、GET、PUTなどのリクエスト送信ができる。  |
| Fake Store API        | [https://fakestoreapi.com/](https://fakestoreapi.com/)                         | 商品データ（ECサイト風）を取得できるAPI。         |
| OpenWeatherMap（API部分） | [https://openweathermap.org/api](https://openweathermap.org/api)               | 天気情報を取得するAPI。Ajax学習に向いてる。       |

### 特におすすめ

【JSONPlaceholder】
- ブラウザでURLを叩くだけでリアルなAPI通信が発生する
- 無料、登録不要
- 失敗しても問題ない（テスト専用）

「GET通信でリストを取得」みたいな練習に向いている

## 補足

開発者ツールの「Network → XHR」を見ながら、上のサイトで

- ページを読み込んだり
- ボタンを押したり

して、Ajax通信が流れる様子を観察できる

